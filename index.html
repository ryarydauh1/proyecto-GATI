<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventario TI - Gestión Fiscal e Inversión</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        .farmatodo-blue { background-color: #004a99; }
        .table-container { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); border-radius: 0.75rem; overflow: hidden; background: white; }
        .tab-btn.active { border-bottom: 3px solid #004a99; color: #004a99; font-weight: 700; }
        .filter-btn.active { background-color: #004a99; color: white; }
        .sticky-col { position: sticky; left: 0; background-color: white; z-index: 10; border-right: 1px solid #e5e7eb; }
        .header-sticky-col { position: sticky; left: 0; background-color: #004a99; z-index: 20; }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-full mx-auto">
        <!-- Header -->
        <header class="mb-6 flex flex-col lg:flex-row lg:items-end justify-between gap-6">
            <div>
                <h1 class="text-3xl font-bold text-gray-800">Farmatodo <span class="text-blue-700">Venezuela</span></h1>
                <p class="text-gray-500 font-medium text-sm">Dashboard de Activos TI & Gestión de Stock Sobrante</p>
            </div>
            
            <!-- Navigation Tabs -->
            <div class="flex border-b border-gray-200 overflow-x-auto">
                <button onclick="switchTab('summary')" id="tab-summary" class="tab-btn active px-6 py-2 text-xs uppercase tracking-wider whitespace-nowrap">Resumen General</button>
                <button onclick="switchTab('detailed')" id="tab-detailed" class="tab-btn px-6 py-2 text-xs uppercase tracking-wider whitespace-nowrap">Detalle por Tienda</button>
                <button onclick="switchTab('investment')" id="tab-investment" class="tab-btn px-6 py-2 text-xs uppercase tracking-wider whitespace-nowrap text-blue-600">Indicador de Inversión y Stock</button>
            </div>
        </header>

        <!-- TAB: RESUMEN GENERAL -->
        <div id="content-summary">
            <div class="mb-4 flex flex-col md:flex-row gap-4 justify-between items-center">
                <div class="bg-white p-2 rounded-lg shadow-sm border border-gray-100 flex gap-2 items-center">
                    <button onclick="setFilter('all')" id="btn-all" class="filter-btn active px-3 py-1.5 text-[11px] font-medium border rounded-md transition-all">Todos</button>
                    <button onclick="setFilter('shortage')" id="btn-shortage" class="filter-btn px-3 py-1.5 text-[11px] font-medium border border-red-200 text-red-600 rounded-md transition-all">Déficit (Compra)</button>
                    <button onclick="setFilter('surplus')" id="btn-surplus" class="filter-btn px-3 py-1.5 text-[11px] font-medium border border-cyan-200 text-cyan-600 rounded-md transition-all">Stock Sobrante</button>
                </div>
                <input type="text" id="searchInput" placeholder="Buscar equipo..." class="w-full md:max-w-xs px-4 py-1.5 text-sm border border-gray-300 rounded-md outline-none">
            </div>
            <div class="table-container">
                <div class="overflow-x-auto">
                    <table class="w-full text-left border-collapse" id="inventoryTable">
                        <thead>
                            <tr class="farmatodo-blue text-white uppercase text-[10px] tracking-wider">
                                <th class="px-6 py-4 font-bold">Equipo</th>
                                <th class="px-4 py-4 text-center">Inv. Inicial</th>
                                <th class="px-4 py-4 text-center">Recibidos</th>
                                <th class="px-4 py-4 text-center">En Tránsito</th>
                                <th class="px-4 py-4 text-center">Consumo</th>
                                <th class="px-4 py-4 text-center">Plan Proyecto</th>
                                <th class="px-4 py-4 text-center bg-blue-900">Estatus de Inventario</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200"></tbody>
                    </table>
                </div>
            </div>
            <div class="mt-4 flex gap-6 text-[10px] uppercase font-bold text-gray-500">
                <div class="flex items-center gap-2"><span class="w-3 h-3 bg-red-100 border border-red-400 rounded"></span> Déficit Requerido</div>
                <div class="flex items-center gap-2"><span class="w-3 h-3 bg-cyan-100 border border-cyan-400 rounded"></span> Stock Sobrante (Próximas Tiendas)</div>
            </div>
        </div>

        <!-- TAB: DETALLE POR TIENDA -->
        <div id="content-detailed" class="hidden">
            <div class="mb-4 flex justify-end">
                <input type="text" id="searchDetailedInput" oninput="renderDetailedTable()" placeholder="Filtrar por tienda o equipo..." class="w-full md:max-w-xs px-4 py-1.5 text-sm border border-gray-300 rounded-md outline-none">
            </div>
            <div class="table-container">
                <div class="overflow-x-auto">
                    <table class="w-full text-left border-collapse text-[9px]" id="detailedTable">
                        <thead>
                            <tr class="farmatodo-blue text-white uppercase tracking-wider">
                                <th class="px-3 py-4 font-bold header-sticky-col min-w-[180px]">Equipos</th>
                                <th class="px-1 py-4 text-center">ISABELICA</th>
                                <th class="px-1 py-4 text-center">MAIQUETIA</th>
                                <th class="px-1 py-4 text-center">C. ACOSTA</th>
                                <th class="px-1 py-4 text-center">CUMBRES</th>
                                <th class="px-1 py-4 text-center">OBELISCO</th>
                                <th class="px-1 py-4 text-center">ANITA</th>
                                <th class="px-1 py-4 text-center">ORINOCO</th>
                                <th class="px-1 py-4 text-center">PUNCERES</th>
                                <th class="px-1 py-4 text-center">ARBOLITOS</th>
                                <th class="px-1 py-4 text-center">MARACAIBO</th>
                                <th class="px-1 py-4 text-center bg-blue-700">TIENDA 1</th>
                                <th class="px-1 py-4 text-center bg-blue-700">TIENDA 2</th>
                                <th class="px-1 py-4 text-center bg-indigo-700">MUDANZA 1</th>
                                <th class="px-1 py-4 text-center bg-indigo-700">MUDANZA 2</th>
                                <th class="px-1 py-4 text-center bg-indigo-800">MUDANZA 3</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- TAB: INVERSIÓN (GRÁFICA) -->
        <div id="content-investment" class="hidden">
            <!-- Sección de inversión similar a la anterior -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100 lg:col-span-2">
                    <h3 class="text-sm font-bold text-gray-500 uppercase mb-4">Inversión vs. Activos en Stock (USD)</h3>
                    <div class="h-[400px]">
                        <canvas id="investmentChart"></canvas>
                    </div>
                </div>
                <div class="flex flex-col gap-6">
                    <div class="bg-blue-600 p-6 rounded-xl shadow-lg text-white">
                        <h3 class="text-xs uppercase font-bold opacity-80 mb-1">Inversión Pendiente</h3>
                        <p class="text-3xl font-bold" id="totalInvestmentLabel">$0.00</p>
                    </div>
                    <div class="bg-cyan-600 p-6 rounded-xl shadow-lg text-white">
                        <h3 class="text-xs uppercase font-bold opacity-80 mb-1">Valor en Stock (Sobrante)</h3>
                        <p class="text-3xl font-bold" id="totalSurplusLabel">$0.00</p>
                    </div>
                </div>
            </div>
            <!-- Tabla de inversión se mantiene operativa -->
            <div class="table-container">
                <div class="overflow-x-auto">
                    <table class="w-full text-left border-collapse" id="investmentTable">
                        <thead>
                            <tr class="bg-gray-800 text-white uppercase text-[10px]">
                                <th class="px-6 py-3">Equipo</th>
                                <th class="px-4 py-3 text-right">Costo Unitario ($)</th>
                                <th class="px-4 py-3 text-center">Unidades</th>
                                <th class="px-4 py-3 text-center">Condición</th>
                                <th class="px-4 py-3 text-right bg-gray-700">Valorización ($)</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200 text-sm"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Datos para el resumen general
        const summaryData = [
            ["ACCESS POINT MERAKI", 21, 0, 18, 21, 21, -3],
            ["BASE DE LECTORA DE PRECIOS CC6600", 36, 0, 5, 35, 20, -14],
            ["BIOMETRICO ASISTENCIAL", 3, 0, 5, 6, 7, -5],
            ["CABLE DE GAVETA 2 METROS", 0, 0, 0, 45, 49, -94],
            ["CABLE EXENTRICO", 280, 0, 0, 88, 105, 87],
            ["CABLE PINPAD USB", 96, 0, 0, 88, 105, -97],
            ["CABLE PROLIFIC", 280, 0, 0, 88, 105, 87],
            ["CABLE USB TIPO-C HAND HELD", 16, 0, 0, 14, 14, -12],
            ["CARGADOR DE CUNA HAND HELD", 16, 0, 0, 14, 14, -12],
            ["CARGADOR DE IMPRESORA PORTATIL", 8, 0, 19, 13, 14, 0],
            ["CARGADOR DE LECTORA DE PRECIOS", 26, 0, 15, 35, 35, -29],
            ["CARGADOR MERAKI", 9, 0, 0, 7, 7, -5],
            ["TUBO DE CAJA", 300, 0, 0, 66, 71, 163],
            ["CPU CAJA ALL IN ONE 3NSTAR PTE0912", 96, 0, 0, 60, 74, -38],
            ["CPU ESTACIÓN OPTIPLEX 3080", 4, 0, 0, 10, 8, -14],
            ["CPU ESTACIÓN BEELINK", 20, 0, 0, 15, 24, -19],
            ["CUNA DE HANDHELD", 16, 0, 0, 12, 8, -4],
            ["ESCANER", 127, 0, 0, 59, 74, -6],
            ["CABLE DE ESCANER", 56, 0, 0, 59, 74, -77],
            ["FORRO DE HAND HELD", 0, 20, 0, 26, 28, -34],
            ["FORRO IMPRESORA PORTATIL", 16, 0, 0, 13, 14, -11],
            ["GAVETA 3NSTAR", 54, 30, 0, 42, 49, -7],
            ["HAND HELD", 4, 20, 0, 25, 22, -23],
            ["HKA", 380, 0, 0, 88, 105, 187],
            ["IMPRESORA FISCAL SRP812", 380, 0, 0, 88, 105, 187],
            ["IMPRESORA PORTATIL", 6, 19, 19, 13, 14, 17],
            ["LECTORA ZEBRA", 32, 10, 15, 35, 35, -13],
            ["MERAKI CISCO MX67", 8, 0, 0, 7, 7, -6],
            ["MONITOR DE ESTACION", 0, 0, 0, 25, 32, -57],
            ["BIOPAGO", 70, 0, 0, 96, 105, -131],
            ["PIN PAD P200", 96, 0, 0, 96, 105, -105],
            ["PROTECTOR DE PANTALLA HAND HELD", 0, 0, 0, 26, 28, -54],
            ["SERVIDOR", 8, 0, 0, 6, 7, -5],
            ["SWITCH CISCO 48 PUERTOS", 4, 5, 0, 7, 10, -8],
            ["TECLADO +MOUSE USB", 0, 0, 0, 24, 32, -56],
            ["TELEFONO IP CISCO 7821", 12, 0, 0, 18, 25, -31],
            ["VISOR DE PRECIO 3NSTAR", 200, 0, 0, 58, 70, 72],
            ["BIOPAGO 2", 150, 0, 0, 97, 105, -52],
            ["AUTOSERVICIO", 0, 9, 0, 5, 3, 1]
        ];

        // Datos para el detalle por tienda (Actualizado según requerimiento)
        const detailedData = [
            ["ACCESS POINT MERAKI", 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3],
            ["BASE DE LECTORA DE PRECIOS CC6600", 5, 5, 5, 5, 5, 5, 5, 0, 5, 5, 5, 5, 0, 0, 0],
            ["BIOMETRICO ASISTENCIAL", 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1],
            ["CABLE DE GAVETA 2 METROS", 8, 9, 7, 7, 7, 0, 7, 7, 7, 7, 7, 7, 7, 7, 7],
            ["CABLE EXENTRICO", 14, 16, 13, 13, 16, 4, 12, 15, 14, 15, 15, 15, 15, 15, 15],
            ["CABLE PINPAD USB", 14, 16, 13, 13, 16, 4, 12, 15, 14, 15, 15, 15, 15, 15, 15],
            ["CABLE PROLIFIC", 14, 16, 13, 13, 16, 4, 12, 15, 14, 15, 15, 15, 15, 15, 15],
            ["CABLE USB TIPO-C HAND HELD TC210K", 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2],
            ["CARGADOR DE CUNA HAND HELD TC210K", 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2],
            ["CARGADOR DE IMPRESORA PORTATIL ZQ620", 2, 2, 2, 2, 2, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2],
            ["CARGADOR DE LECTORA DE PRECIOS CC6600", 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5],
            ["CARGADOR MERAKI", 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
            ["TUBO DE CAJA", 9, 11, 9, 9, 11, 8, 9, 9, 9, 11, 11, 11, 9, 9, 9],
            ["CPU CAJA ALL IN ONE 3NSTAR PTE0912", 9, 11, 9, 9, 11, 2, 9, 10, 10, 11, 11, 11, 10, 10, 10],
            ["CPU ESTACIÓN OPTIPLEX 3080", 2, 2, 2, 2, 2, 0, 0, 0, 0, 2, 2, 2, 0, 0, 0],
            ["CPU ESTACIÓN BEELINK", 2, 2, 2, 2, 2, 1, 4, 4, 4, 3, 3, 3, 4, 4, 4],
            ["CUNA DE HANDHELD TC210K", 2, 2, 2, 2, 2, 0, 2, 0, 0, 2, 2, 2, 0, 0, 0],
            ["ESCANER ZEBRA DS9308", 9, 11, 9, 9, 11, 1, 9, 10, 10, 11, 11, 11, 10, 10, 10],
            ["CABLE DE ESCANER ZEBRA DS9308", 9, 11, 9, 9, 11, 1, 9, 10, 10, 11, 11, 11, 10, 10, 10],
            ["FORRO DE HAND HELD TC210K", 4, 4, 4, 4, 4, 2, 4, 4, 4, 4, 4, 4, 4, 4, 4],
            ["FORRO IMPRESORA PORTATIL ZQ620", 2, 2, 2, 2, 2, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2],
            ["GAVETA 3NSTAR", 7, 7, 7, 7, 7, 0, 7, 7, 7, 7, 7, 7, 7, 7, 7],
            ["HAND HELD TC210K", 4, 3, 4, 4, 4, 2, 4, 2, 4, 4, 4, 4, 2, 2, 2],
            ["HKA", 14, 16, 13, 13, 16, 4, 12, 15, 14, 15, 15, 15, 15, 15, 15],
            ["IMPRESORA FISCAL SRP812", 14, 16, 13, 13, 16, 4, 12, 15, 14, 15, 15, 15, 15, 15, 15],
            ["IMPRESORA PORTATIL ZEBRA ZQ620", 2, 2, 2, 2, 2, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2],
            ["LECTORA ZEBRA CC6600", 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5],
            ["MERAKI CISCO MX67", 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
            ["MONITOR DE ESTACION", 5, 4, 4, 4, 4, 0, 4, 4, 4, 5, 5, 5, 4, 4, 4],
            ["BIOPAGO", 14, 16, 13, 13, 16, 12, 12, 15, 14, 15, 15, 15, 15, 15, 15],
            ["PIN PAD P200", 14, 16, 13, 13, 16, 12, 12, 15, 14, 15, 15, 15, 15, 15, 15],
            ["PROTECTOR DE PANTALLA HAND HELD TC210K", 4, 4, 4, 4, 4, 2, 4, 4, 4, 4, 4, 4, 4, 4, 4],
            ["SERVIDOR DELL R450", 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1],
            ["SWITCH CISCO 48 PUERTOS", 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 1, 1, 1],
            ["TECLADO +MOUSE USB", 4, 4, 4, 4, 4, 0, 4, 4, 4, 5, 5, 5, 4, 4, 4],
            ["TELEFONO IP CISCO 7821", 3, 3, 3, 3, 3, 0, 3, 3, 3, 4, 4, 4, 3, 3, 3],
            ["VISOR DE PRECIO 3NSTAR", 9, 10, 9, 9, 11, 1, 9, 10, 10, 10, 10, 10, 10, 10, 10],
            ["AUTOSERVICIO", 1, 1, 1, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0]
        ];

        const costMapping = {
            "CABLE EXENTRICO": 20, "CABLE PROLIFIC": 20, "HKA": 435, "IMPRESORA FISCAL SRP812": 722,
            "IMPRESORA PORTATIL": 550, "VISOR DE PRECIO 3NSTAR": 182, "TUBO DE CAJA": 110, "AUTOSERVICIO": 6234
        };

        let currentFilter = 'all';
        let investmentChartInstance = null;

        function switchTab(tabId) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`tab-${tabId}`).classList.add('active');
            
            document.getElementById('content-summary').classList.add('hidden');
            document.getElementById('content-detailed').classList.add('hidden');
            document.getElementById('content-investment').classList.add('hidden');
            
            document.getElementById(`content-${tabId}`).classList.remove('hidden');

            if (tabId === 'detailed') renderDetailedTable();
            if (tabId === 'investment') renderInvestmentTab();
        }

        function setFilter(filter) {
            currentFilter = filter;
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`btn-${filter}`).classList.add('active');
            renderSummaryTable();
        }

        function renderSummaryTable() {
            const tbody = document.querySelector('#inventoryTable tbody');
            const search = document.getElementById('searchInput').value.toLowerCase();
            tbody.innerHTML = '';

            summaryData.forEach(item => {
                const [name, init, rec, trans, cons, req, pending] = item;
                if (!name.toLowerCase().includes(search)) return;
                
                if (currentFilter === 'shortage' && pending >= 0) return;
                if (currentFilter === 'surplus' && pending <= 0) return;

                const row = document.createElement('tr');
                row.className = "hover:bg-gray-50 text-[11px]";
                
                let statusText = '';
                let bgClass = '';
                let textClass = '';

                if (pending < 0) {
                    statusText = `${Math.abs(pending)} (DÉFICIT)`;
                    bgClass = 'bg-red-50';
                    textClass = 'text-red-700 font-bold';
                } else if (pending > 0) {
                    statusText = `${pending} (SOBRANTE)`;
                    bgClass = 'bg-cyan-50';
                    textClass = 'text-cyan-700 font-bold';
                } else {
                    statusText = '0 (SALDO)';
                    bgClass = 'bg-gray-50';
                    textClass = 'text-gray-400';
                }

                row.innerHTML = `<td class="px-6 py-3 font-semibold sticky-col">${name}</td>
                    <td class="text-center">${init}</td><td class="text-center">${rec}</td>
                    <td class="text-center">${trans}</td><td class="text-center">${cons}</td>
                    <td class="text-center">${req}</td>
                    <td class="text-center ${textClass} ${bgClass} border-l border-gray-100">${statusText}</td>`;
                tbody.appendChild(row);
            });
        }

        function renderDetailedTable() {
            const tbody = document.querySelector('#detailedTable tbody');
            const search = document.getElementById('searchDetailedInput').value.toLowerCase();
            tbody.innerHTML = '';

            detailedData.forEach(item => {
                const name = item[0];
                if (!name.toLowerCase().includes(search)) return;

                const row = document.createElement('tr');
                row.className = "hover:bg-gray-50 text-center";
                
                let cells = `<td class="px-3 py-3 font-semibold text-left sticky-col">${name}</td>`;
                for (let i = 1; i < item.length; i++) {
                    const val = item[i];
                    // Resaltar cantidades significativas
                    const bg = val > 10 ? 'bg-blue-50/50 font-semibold' : '';
                    const color = val === 0 ? 'text-gray-300' : 'text-gray-700';
                    cells += `<td class="px-1 py-3 ${bg} ${color}">${val}</td>`;
                }
                
                row.innerHTML = cells;
                tbody.appendChild(row);
            });
        }

        function renderInvestmentTab() {
            const tbody = document.querySelector('#investmentTable tbody');
            tbody.innerHTML = '';
            let totalInvestment = 0;
            let totalSurplus = 0;

            const displayData = summaryData.map(item => {
                const name = item[0];
                const qty = item[6];
                let unitCost = costMapping[name] || 0;
                
                const originalCosts = [
                    ["ACCESS POINT MERAKI", 289.52], ["BASE DE LECTORA DE PRECIOS CC6600", 120], ["BIOMETRICO ASISTENCIAL", 2148],
                    ["CABLE DE GAVETA 2 METROS", 10], ["CABLE PINPAD USB", 20], ["CABLE USB TIPO-C HAND HELD", 10],
                    ["CPU CAJA ALL IN ONE 3NSTAR PTE0912", 1534], ["CPU ESTACIÓN BEELINK", 190], ["ESCANER", 60],
                    ["FORRO DE HAND HELD", 25], ["FORRO IMPRESORA PORTATIL", 40], ["GAVETA 3NSTAR", 90],
                    ["HAND HELD", 330], ["LECTORA ZEBRA", 410], ["MERAKI CISCO MX67", 741], ["MONITOR DE ESTACION", 150],
                    ["BIOPAGO", 100.44], ["PIN PAD P200", 288], ["PROTECTOR DE PANTALLA HAND HELD", 25],
                    ["SERVIDOR", 3781], ["SWITCH CISCO 48 PUERTOS", 1377.9], ["TECLADO +MOUSE USB", 20],
                    ["TELEFONO IP CISCO 7821", 169], ["BIOPAGO 2", 100.44]
                ].find(i => i[0] === name);

                if (originalCosts) unitCost = originalCosts[1];

                const valorization = Math.abs(qty) * unitCost;
                return { name, unitCost, qty, valorization };
            }).filter(i => i.valorization > 0);

            displayData.forEach(item => {
                if (item.qty < 0) totalInvestment += item.valorization;
                else totalSurplus += item.valorization;

                const row = document.createElement('tr');
                row.className = "hover:bg-gray-50";
                const isSurplus = item.qty > 0;
                
                row.innerHTML = `
                    <td class="px-6 py-3 font-medium text-gray-700">${item.name}</td>
                    <td class="px-4 py-3 text-right text-gray-500">$ ${item.unitCost.toLocaleString()}</td>
                    <td class="px-4 py-3 text-center">${Math.abs(item.qty)}</td>
                    <td class="px-4 py-3 text-center">
                        <span class="px-2 py-0.5 rounded-full text-[10px] font-bold ${isSurplus ? 'bg-cyan-100 text-cyan-700' : 'bg-red-100 text-red-700'}">
                            ${isSurplus ? 'STOCK DISPONIBLE' : 'POR COMPRAR'}
                        </span>
                    </td>
                    <td class="px-4 py-3 text-right font-bold ${isSurplus ? 'text-cyan-700 bg-cyan-50/20' : 'text-red-700 bg-red-50/20'}">$ ${item.valorization.toLocaleString()}</td>
                `;
                tbody.appendChild(row);
            });

            document.getElementById('totalInvestmentLabel').innerText = `$ ${totalInvestment.toLocaleString(undefined, {minimumFractionDigits: 2})}`;
            document.getElementById('totalSurplusLabel').innerText = `$ ${totalSurplus.toLocaleString(undefined, {minimumFractionDigits: 2})}`;

            renderChart(displayData);
        }

        function renderChart(data) {
            const ctx = document.getElementById('investmentChart').getContext('2d');
            if (investmentChartInstance) investmentChartInstance.destroy();

            const topShortage = data.filter(i => i.qty < 0).sort((a,b) => b.valorization - a.valorization).slice(0, 5);
            const topSurplus = data.filter(i => i.qty > 0).sort((a,b) => b.valorization - a.valorization).slice(0, 5);
            
            const combinedLabels = [...topShortage.map(i => i.name), ...topSurplus.map(i => i.name)];
            const shortageValues = [...topShortage.map(i => i.valorization), ...topSurplus.map(i => 0)];
            const surplusValues = [...topShortage.map(i => 0), ...topSurplus.map(i => i.valorization)];

            investmentChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: combinedLabels,
                    datasets: [
                        { label: 'Déficit (Inversión)', data: shortageValues, backgroundColor: '#ef4444', borderRadius: 4 },
                        { label: 'Sobrante (Stock)', data: surplusValues, backgroundColor: '#0891b2', borderRadius: 4 }
                    ]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom', labels: { boxWidth: 12, font: { size: 10 } } } },
                    scales: { 
                        x: { stacked: true, ticks: { font: { size: 9 } } },
                        y: { stacked: true, ticks: { font: { size: 9 } } }
                    }
                }
            });
        }

        document.getElementById('searchInput').addEventListener('input', renderSummaryTable);
        window.onload = () => {
            renderSummaryTable();
        };
    </script>
</body>
</html>
